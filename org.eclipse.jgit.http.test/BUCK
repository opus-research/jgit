PREFIX = 'tst/org/eclipse/jgit/http'
HTTP = glob([PREFIX + '**/*Test.java'])

for test in HTTP:
  e = test.index('.java')
  java_test(
    name = test[len(PREFIX):e].replace('/', '.'),
    srcs = [test],
    deps = [':test_util'],
    labels = ['http'],
  )

java_library(
  name = 'test_util',
  srcs = glob([PREFIX + '**/*.java'], excludes = HTTP),
  deps = [
    '//org.eclipse.jgit:http_util',
    '//org.eclipse.jgit:lib',
    '//org.eclipse.jgit:nls',
    '//org.eclipse.jgit:progress',
    '//org.eclipse.jgit:text',
    '//org.eclipse.jgit:transport_client',
    '//org.eclipse.jgit:transport_resolver',
    '//org.eclipse.jgit:transport_server',
    '//org.eclipse.jgit:util',
    '//org.eclipse.jgit.junit:junit',
    '//org.eclipse.jgit.junit.http:http',
    '//org.eclipse.jgit.http.server:server',
    '//lib:junit',
    '//lib:servlet-api',
    '//lib/jetty:http',
    '//lib/jetty:io',
    '//lib/jetty:security',
    '//lib/jetty:server',
    '//lib/jetty:servlet',
    '//lib/jetty:util',
  ],
  export_deps = True,
  visibility = ['//tools:eclipse_classpath'],
)
